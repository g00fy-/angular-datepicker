"use strict";!function(a){function b(a,b){a=new Date(a||new Date),a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours());for(var c=[],d=a.getTime()+36e5;a.getTime()<d;)c.push(a),a=new Date(a.getTime()+60*b*1e3);return c}function c(a){a=new Date(a||new Date);var b=a.getMonth(),c=a.getYear();a.setDate(1),a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),a.setDate(0===a.getDay()?-5:a.getDate()-(a.getDay()-1)),1===a.getDate()&&a.setDate(-6);for(var d=[];d.length<6&&!(a.getYear()===c&&a.getMonth()>b);){for(var e=[],f=0;7>f;f++)e.push(new Date(a)),a.setDate(a.getDate()+1);d.push(e)}return d}function d(a){var b=[];a=new Date(a||new Date),a.setFullYear(a.getFullYear()-a.getFullYear()%10);for(var c=0;12>c;c++)b.push(new Date(a.getFullYear()+(c-1),0,1));return b}function e(a){a=new Date(a||new Date),a=new Date(a.getFullYear(),a.getMonth(),a.getDate()),a.setDate(a.getDate()-(a.getDay()-1));for(var b=[],c=0;7>c;c++)b.push(new Date(a)),a.setDate(a.getDate()+1);return b}function f(a){a=new Date(a||new Date);for(var b=a.getFullYear(),c=[],d=0;12>d;d++)c.push(new Date(b,d,1));return c}function g(a){a=new Date(a||new Date),a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0);for(var b=[],c=0;24>c;c++)b.push(a),a=new Date(a.getTime()+36e5);return b}function h(a,b){return a&&a.getTime()<=b.getTime()}function i(a,b){return a.getTime()>=b.getTime()}function j(a,b){return a&&a.getFullYear()===b.getFullYear()}function k(a,b){return j(a,b)&&a.getMonth()===b.getMonth()}function l(a,b){return k(a,b)&&a.getDate()===b.getDate()}function m(a,b){return l(a,b)&&a.getHours()===b.getHours()}function n(a,b){return m(a,b)&&a.getMinutes()===b.getMinutes()}function o(a,b,c){var d={minute:n,hour:m,day:l,month:k,year:j};return d[c]&&d[c](a,b)}var p=a.module("datePicker",[]);p.constant("datePickerConfig",{template:"templates/datepicker.html",view:"month",views:["year","month","date","hours","minutes"],step:5}),p.filter("time",function(){function a(a){return("0"+a.getHours()).slice(-2)+":"+("0"+a.getMinutes()).slice(-2)}return function(b){return b instanceof Date||(b=new Date(b),!isNaN(b.getTime()))?a(b):void 0}}),p.directive("datePicker",["datePickerConfig",function(a){return{template:'<div ng-include="template"></div>',scope:{model:"=datePicker",after:"=?",before:"=?",minDate:"=?",maxDate:"=?"},link:function(p,q,r){function s(){var a=p.view,h=p.date;switch(a){case"year":p.years=d(h);break;case"month":p.months=f(h);break;case"date":p.weekdays=p.weekdays||e(),p.weeks=c(h);break;case"hours":p.hours=g(h);break;case"minutes":p.minutes=b(h,u)}}function t(){return"date"!==p.view?p.view:p.model?p.model.getMonth():null}p.date=new Date(p.model||new Date),p.views=a.views.concat(),p.view=r.view||a.view,p.now=new Date,p.template=r.template||a.template;var u=parseInt(r.step||a.step,10),v=!!r.partial;p.views=p.views.slice(p.views.indexOf(r.maxView||"year"),p.views.indexOf(r.minView||"minutes")+1),(1===p.views.length||-1===p.views.indexOf(p.view))&&(p.view=p.views[0]),p.setView=function(a){-1!==p.views.indexOf(a)&&(p.view=a)},p.setDate=function(a){p.date=a;var b=p.views[p.views.indexOf(p.view)+1];if(!b||v||p.model){p.model=new Date(p.model||a);var c=v?"minutes":p.view;switch(c){case"minutes":p.model.setMinutes(a.getMinutes());case"hours":p.model.setHours(a.getHours());case"date":p.model.setDate(a.getDate());case"month":p.model.setMonth(a.getMonth());case"year":p.model.setFullYear(a.getFullYear())}p.$emit("setDate",p.model,p.view)}b&&p.setView(b)},p.$watch(t,s),p.$watch("minDate",function(){!p.minDate||p.minDate instanceof Date||(p.minDate=new Date(p.minDate))}),p.$watch("maxDate",function(){!p.maxDate||p.maxDate instanceof Date||(p.maxDate=new Date(p.maxDate))}),p.next=function(a){var b=p.date;switch(a=a||1,p.view){case"year":case"month":b.setFullYear(b.getFullYear()+a);break;case"date":b.setMonth(b.getMonth()+a);break;case"hours":case"minutes":b.setHours(b.getHours()+a)}s()},p.isValid=function(a,b){return p.minDate&&a<p.minDate&&!o(a,p.minDate,b)?!1:p.maxDate&&a>p.maxDate&&!o(a,p.maxDate,b)?!1:!0},p.prev=function(a){return p.next(-a||-1)},p.isAfter=function(a){return p.after&&h(a,p.after)},p.isBefore=function(a){return p.before&&i(a,p.before)},p.isSameMonth=function(a){return k(p.date,a)},p.isSameYear=function(a){return j(p.date,a)},p.isSameDay=function(a){return l(p.date,a)},p.isSameHour=function(a){return m(p.date,a)},p.isSameMinutes=function(a){return n(p.date,a)},p.isNow=function(a){var b=!0,c=p.now;switch(p.view){case"minutes":b&=~~(a.getMinutes()/u)===~~(c.getMinutes()/u);case"hours":b&=a.getHours()===c.getHours();case"date":b&=a.getDate()===c.getDate();case"month":b&=a.getMonth()===c.getMonth();case"year":b&=a.getFullYear()===c.getFullYear()}return b}}}}]);var p=a.module("datePicker");p.directive("dateRange",function(){return{templateUrl:"templates/daterange.html",scope:{start:"=",end:"="},link:function(a){a.$watch("start.getTime()",function(b){b&&a.end&&b>a.end.getTime()&&(a.end=new Date(b))}),a.$watch("end.getTime()",function(b){b&&a.start&&b<a.start.getTime()&&(a.start=new Date(b))})}}});var q="ng-pristine",r="ng-dirty",p=a.module("datePicker");p.constant("dateTimeConfig",{template:function(a){return'<div date-picker="'+a.ngModel+'" '+(a.view?'view="'+a.view+'" ':"")+(a.maxView?'max-view="'+a.maxView+'" ':"")+(a.template?'template="'+a.template+'" ':"")+(a.minView?'min-view="'+a.minView+'" ':"")+(a.partial?'partial="'+a.partial+'" ':"")+'class="dropdown-menu"></div>'},format:"yyyy-MM-dd HH:mm",views:["date","year","month","hours","minutes"],dismiss:!1,position:"relative"}),p.directive("dateTimeAppend",function(){return{link:function(a,b){b.bind("click",function(){b.find("input")[0].focus()})}}}),p.directive("dateTime",["$compile","$document","$filter","dateTimeConfig","$parse",function(b,c,d,e,f){var g=c.find("body"),h=d("date");return{require:"ngModel",scope:!0,link:function(c,d,i,j){function k(a){return h(a,p)}function l(){return j.$modelValue}function m(a){a.stopPropagation(),j.$pristine&&(j.$dirty=!0,j.$pristine=!1,d.removeClass(q).addClass(r),s&&s.$setDirty(),j.$render())}function n(){y&&(y.remove(),y=null),A&&(A.remove(),A=null)}function o(){if(!y){if(y=b(B)(c),c.$digest(),c.$on("setDate",function(a,b,c){m(a),w&&x===c&&document.activeElement!==document.body&&document.activeElement.blur()}),c.$on("$destroy",n),"absolute"===z){var e=a.extend(d.offset(),{height:d[0].offsetHeight});y.css({top:e.top+e.height,left:e.left,display:"block",position:z}),g.append(y)}else A=a.element("<div date-picker-wrapper></div>"),d[0].parentElement.insertBefore(A[0],d[0]),A.append(y),y.css({top:d[0].offsetHeight+"px",display:"block"});y.bind("mousedown",function(a){a.preventDefault()})}}var p=i.format||e.format,s=d.inheritedData("$formController"),t=f(i.views)(c)||e.views.concat(),u=i.view||t[0],v=t.indexOf(u),w=i.dismiss?f(i.dismiss)(c):e.dismiss,x=i.minView||e.views[e.views.length-1],y=null,z=i.position||e.position,A=null;-1===v&&t.splice(v,1),t.unshift(u),j.$formatters.push(k),j.$parsers.unshift(l);var B=e.template(i);d.bind("focus",o),d.bind("blur",n)}}}]),a.module("datePicker").run(["$templateCache",function(a){a.put("templates/datepicker.html",'<div ng-switch="view">\n  <div ng-switch-when="date">\n    <table>\n      <thead>\n      <tr>\n        <th ng-click="prev()">‹</th>\n        <th colspan="5" class="switch" ng-click="setView(\'month\')">{{date|date:"yyyy MMMM"}}</th>\n        <th ng-click="next()">›</i></th>\n      </tr>\n      <tr>\n        <th ng-repeat="day in weekdays" style="overflow: hidden">{{ day|date:"EEE" }}</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="week in weeks">\n        <td ng-repeat="day in week">\n          <span\n            ng-class="{\'now\':isNow(day),\'disabled\':!isValid(day, \'day\'), \'active\':isSameDay(day),\'disabled\':(day.getMonth()!=date.getMonth()),\'after\':isAfter(day),\'before\':isBefore(day)}"\n            ng-click="isValid(day, \'day\') && setDate(day)" ng-bind="day.getDate()"></span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <div ng-switch-when="year">\n    <table>\n      <thead>\n      <tr>\n        <th ng-click="prev(10)">‹</th>\n        <th colspan="5" class="switch">{{years[0].getFullYear()}}-{{years[years.length-1].getFullYear()}}</th>\n        <th ng-click="next(10)">›</i></th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr>\n        <td colspan="7">\n          <span ng-class="{\'active\':isSameYear(year),\'disabled\':!isValid(year, \'year\'), \'now\':isNow(year)}"\n                ng-repeat="year in years"\n                ng-click="isValid(year, \'year\') && setDate(year)" ng-bind="year.getFullYear()"></span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <div ng-switch-when="month">\n    <table>\n      <thead>\n      <tr>\n        <th ng-click="prev()">‹</th>\n        <th colspan="5" class="switch" ng-click="setView(\'year\')">{{ date|date:"yyyy" }}</th>\n        <th ng-click="next()">›</i></th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr>\n        <td colspan="7">\n          <span ng-repeat="month in months"\n                ng-class="{\'active\':isSameMonth(month),\'disabled\':!isValid(month, \'month\'), \'after\':isAfter(month),\'before\':isBefore(month),\'now\':isNow(month)}"\n                ng-click="isValid(month, \'month\') && setDate(month)"\n                ng-bind="month|date:\'MMM\'"></span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <div ng-switch-when="hours">\n    <table>\n      <thead>\n      <tr>\n        <th ng-click="prev(24)">‹</th>\n        <th colspan="5" class="switch" ng-click="setView(\'date\')">{{ date|date:"dd MMMM yyyy" }}</th>\n        <th ng-click="next(24)">›</i></th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr>\n        <td colspan="7">\n          <span ng-repeat="hour in hours"\n                ng-class="{\'now\':isNow(hour),\'active\':isSameHour(hour),\'disabled\':!isValid(hour, \'hour\') }"\n                ng-click="isValid(hour, \'hour\') && setDate(hour)" ng-bind="hour|time"></span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <div ng-switch-when="minutes">\n    <table>\n      <thead>\n      <tr>\n        <th ng-click="prev()">‹</th>\n        <th colspan="5" class="switch" ng-click="setView(\'hours\')">{{ date|date:"dd MMMM yyyy" }}\n        </th>\n        <th ng-click="next()">›</i></th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr>\n        <td colspan="7">\n          <span ng-repeat="minute in minutes"\n                ng-class="{active:isSameMinutes(minute), \'disabled\':!isValid(minute, \'minute\'), \'now\':isNow(minute)}"\n                ng-click="isValid(minute, \'minute\') && setDate(minute)"\n                ng-bind="minute|time"></span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n</div>\n'),a.put("templates/daterange.html",'<div>\n    <table>\n        <tr>\n            <td valign="top">\n                <div date-picker="start" class="date-picker" date after="start" before="end" min-view="date" max-view="date"></div>\n            </td>\n            <td valign="top">\n                <div date-picker="end" class="date-picker" date after="start" before="end"  min-view="date" max-view="date"></div>\n            </td>\n        </tr>\n    </table>\n</div>\n')}])}(angular);