"use strict";!function(e){var t=e.module("datePicker",[]);t.constant("datePickerConfig",{template:"templates/datepicker.html",view:"month",views:["year","month","date","hours","minutes"],step:5}),t.filter("time",function(){function e(e){return("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)}return function(t){return t instanceof Date||(t=new Date(t),!isNaN(t.getTime()))?e(t):void 0}}),t.directive("datePicker",["datePickerConfig","datePickerUtils",function(t,n){return{require:"?ngModel",template:'<div ng-include="template"></div>',scope:{model:"=datePicker",after:"=?",before:"=?"},link:function(a,i,r,s){function o(){var e=a.view;a.model&&!l&&(a.date=new Date(a.model),l=!1);var t=a.date;switch(e){case"year":a.years=n.getVisibleYears(t);break;case"month":a.months=n.getVisibleMonths(t);break;case"date":a.weekdays=a.weekdays||n.getDaysOfWeek(),a.weeks=n.getVisibleWeeks(t);break;case"hours":a.hours=n.getVisibleHours(t);break;case"minutes":a.minutes=n.getVisibleMinutes(t,c)}}function d(){return"date"!==a.view?a.view:a.date?a.date.getMonth():null}var l=!1;a.date=new Date(a.model||new Date),a.views=t.views.concat(),a.view=r.view||t.view,a.now=new Date,a.template=r.template||t.template,a.watchDirectChanges=void 0!==r.watchDirectChanges,a.callbackOnSetDate=r.onSetDate?a.$parent[r.onSetDate]:void 0;var c=parseInt(r.step||t.step,10),u=!!r.partial;if(s){if(e.isDefined(r.minDate)){var g;s.$validators.min=function(t){return!n.isValidDate(t)||e.isUndefined(g)||t>=g},r.$observe("minDate",function(e){g=new Date(e),s.$validate()})}if(e.isDefined(r.maxDate)){var m;s.$validators.max=function(t){return!n.isValidDate(t)||e.isUndefined(m)||m>=t},r.$observe("maxDate",function(e){m=new Date(e),s.$validate()})}}a.views=a.views.slice(a.views.indexOf(r.maxView||"year"),a.views.indexOf(r.minView||"minutes")+1),(1===a.views.length||-1===a.views.indexOf(a.view))&&(a.view=a.views[0]),a.setView=function(e){-1!==a.views.indexOf(e)&&(a.view=e)},a.setDate=function(e){if(!r.disabled){a.date=e;var t=a.views[a.views.indexOf(a.view)+1];if(!t||u||a.model){a.model=new Date(a.model||e),s&&s.$setViewValue(a.date);var n=u?"minutes":a.view;switch(n){case"minutes":a.model.setMinutes(e.getMinutes());case"hours":a.model.setHours(e.getHours());case"date":a.model.setDate(e.getDate());case"month":a.model.setMonth(e.getMonth());case"year":a.model.setFullYear(e.getFullYear())}!t&&a.model&&(a.$emit("setMaxDate",r.datePicker,a.model,a.view),a.callbackOnSetDate&&a.callbackOnSetDate()),a.$emit("setDate",a.model,a.view)}t&&a.setView(t),t||"true"!==r.autoClose||(i.addClass("hidden"),a.$emit("hidePicker"))}},a.$watch(d,o),a.watchDirectChanges&&a.$watch("model",o),a.next=function(e){var t=a.date;switch(e=e||1,a.view){case"year":case"month":t.setFullYear(t.getFullYear()+e);break;case"date":t.setMonth(t.getMonth()+e);break;case"hours":case"minutes":t.setHours(t.getHours()+e)}l=!0,o()},a.prev=function(e){return a.next(-e||-1)},a.isAfter=function(e){return a.after&&n.isAfter(e,a.after)},a.isBefore=function(e){return a.before&&n.isBefore(e,a.before)},a.isSameMonth=function(e){return n.isSameMonth(a.model,e)},a.isSameYear=function(e){return n.isSameYear(a.model,e)},a.isSameDay=function(e){return n.isSameDay(a.model,e)},a.isSameHour=function(e){return n.isSameHour(a.model,e)},a.isSameMinutes=function(e){return n.isSameMinutes(a.model,e)},a.isNow=function(e){var t=!0,n=a.now;switch(a.view){case"minutes":t&=~~(e.getMinutes()/c)===~~(n.getMinutes()/c);case"hours":t&=e.getHours()===n.getHours();case"date":t&=e.getDate()===n.getDate();case"month":t&=e.getMonth()===n.getMonth();case"year":t&=e.getFullYear()===n.getFullYear()}return t}}}}]),e.module("datePicker").factory("datePickerUtils",function(){var e=function(e,t,n,a,i){return new Date(0|e,0|t,0|n,0|a,0|i)};return{getVisibleMinutes:function(t,n){t=new Date(t||new Date);var a,i,r=t.getFullYear(),s=t.getMonth(),o=t.getDate(),d=t.getHours(),l=[];for(a=0;60>a;a+=n)i=e(r,s,o,d,a),l.push(i);return l},getVisibleWeeks:function(e){e=new Date(e||new Date);var t=e.getMonth(),n=e.getYear();e.setDate(1),e.setDate(0===e.getDay()?-5:e.getDate()-(e.getDay()-1)),1===e.getDate()&&e.setDate(-6);for(var a,i=[];i.length<6&&!(e.getYear()===n&&e.getMonth()>t);)a=this.getDaysOfWeek(e),i.push(a),e.setDate(e.getDate()+7);return i},getVisibleYears:function(t){t=new Date(t||new Date),t.setFullYear(t.getFullYear()-t.getFullYear()%10);for(var n,a=t.getFullYear(),i=[],r=0;12>r;r++)n=e(a),i.push(n),a++;return i},getDaysOfWeek:function(t){t=new Date(t||new Date),t.setDate(t.getDate()-(t.getDay()-1));for(var n,a=t.getFullYear(),i=t.getMonth(),r=t.getDate(),s=[],o=0;7>o;o++)n=e(a,i,r),s.push(n),r++;return s},getVisibleMonths:function(t){t=new Date(t||new Date);for(var n,a=t.getFullYear(),i=[],r=0;12>r;r++)n=e(a,r,1),i.push(n);return i},getVisibleHours:function(t){t=new Date(t||new Date);var n,a,i=t.getFullYear(),r=t.getMonth(),s=t.getDate(),o=[];for(n=0;24>n;n++)a=e(i,r,s,n),o.push(a);return o},isAfter:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),e&&e.getTime()>=t.getTime()},isBefore:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),e.getTime()<=t.getTime()},isSameYear:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),e&&e.getFullYear()===t.getFullYear()},isSameMonth:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),this.isSameYear(e,t)&&e.getMonth()===t.getMonth()},isSameDay:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),this.isSameMonth(e,t)&&e.getDate()===t.getDate()},isSameHour:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),this.isSameDay(e,t)&&e.getHours()===t.getHours()},isSameMinutes:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),this.isSameHour(e,t)&&e.getMinutes()===t.getMinutes()},isValidDate:function(e){return e&&!(e.getTime&&e.getTime()!==e.getTime())}}});var t=e.module("datePicker");t.directive("dateRange",function(){return{templateUrl:"templates/daterange.html",scope:{start:"=",end:"="},link:function(e,t,n){e.start=new Date(e.start||new Date),e.end=new Date(e.end||new Date),n.$observe("disabled",function(t){e.disableDatePickers=!!t}),e.$watch("start.getTime()",function(t){t&&e.end&&t>e.end.getTime()&&(e.end=new Date(t))}),e.$watch("end.getTime()",function(t){t&&e.start&&t<e.start.getTime()&&(e.start=new Date(t))})}}});var n="ng-pristine",a="ng-dirty",t=e.module("datePicker");t.constant("dateTimeConfig",{template:function(e){return'<div date-picker="'+e.ngModel+'" '+(e.view?'view="'+e.view+'" ':"")+(e.maxView?'max-view="'+e.maxView+'" ':"")+(e.autoClose?'auto-close="'+e.autoClose+'" ':"")+(e.template?'template="'+e.template+'" ':"")+(e.minView?'min-view="'+e.minView+'" ':"")+(e.partial?'partial="'+e.partial+'" ':"")+(e.step?'step="'+e.step+'" ':"")+'class="date-picker-date-time"></div>'},format:"yyyy-MM-dd HH:mm",views:["date","year","month","hours","minutes"],autoClose:!1,position:"relative"}),t.directive("dateTimeAppend",function(){return{link:function(e,t){t.bind("click",function(){t.find("input")[0].focus()})}}}),t.directive("dateTime",["$compile","$document","$filter","dateTimeConfig","$parse","datePickerUtils",function(t,i,r,s,o,d){var l=i.find("body"),c=r("date");return{require:"ngModel",scope:!0,link:function(i,r,u,g){function m(e){return c(e,p)}function h(e){return e.length===p.length?e:void 0}function f(e){e.stopPropagation(),g.$pristine&&(g.$dirty=!0,g.$pristine=!1,r.removeClass(n).addClass(a),D&&D.$setDirty(),g.$render())}function w(){$&&($.remove(),$=null),V&&(V.remove(),V=null)}function v(){if(!$){if($=t(H)(i),i.$digest(),i.$on("setDate",function(e,t,n){f(e),M&&b[b.length-1]===n&&w()}),i.$on("hidePicker",function(){r.triggerHandler("blur")}),i.$on("$destroy",w),"absolute"===S){var n=e.extend(r.offset(),{height:r[0].offsetHeight});$.css({top:n.top+n.height,left:n.left,display:"block",position:S}),l.append($)}else V=e.element("<div date-picker-wrapper></div>"),r[0].parentElement.insertBefore(V[0],r[0]),V.append($),$.css({top:r[0].offsetHeight+"px",display:"block"});$.bind("mousedown",function(e){e.preventDefault()})}}var p=u.format||s.format,D=r.inheritedData("$formController"),b=o(u.views)(i)||s.views.concat(),y=u.view||b[0],k=b.indexOf(y),M=u.autoClose?o(u.autoClose)(i):s.autoClose,$=null,S=u.position||s.position,V=null;if(-1===k&&b.splice(k,1),b.unshift(y),g.$formatters.push(m),g.$parsers.unshift(h),e.isDefined(u.minDate)){var x;g.$validators.min=function(t){return!d.isValidDate(t)||e.isUndefined(x)||t>=x},u.$observe("minDate",function(e){x=new Date(e),g.$validate()})}if(e.isDefined(u.maxDate)){var Y;g.$validators.max=function(t){return!d.isValidDate(t)||e.isUndefined(Y)||Y>=t},u.$observe("maxDate",function(e){Y=new Date(e),g.$validate()})}var H=s.template(u);r.bind("focus",v),r.bind("blur",w)}}}]),e.module("datePicker").run(["$templateCache",function(e){e.put("templates/datepicker.html",'<div ng-switch="view">\r\n  <div ng-switch-when="date">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'month\')" ng-bind="date|date:\'yyyy MMMM\'"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      <tr>\r\n        <th ng-repeat="day in weekdays" style="overflow: hidden" ng-bind="day|date:\'EEE\'"></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr ng-repeat="week in weeks">\r\n        <td ng-repeat="day in week">\r\n          <span\r\n            ng-class="{\'now\':isNow(day),\'active\':isSameDay(day),\'disabled\':(day.getMonth()!=date.getMonth()),\'after\':isAfter(day),\'before\':isBefore(day)}"\r\n            ng-click="setDate(day)" ng-bind="day.getDate()"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="year">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev(10)">&lsaquo;</th>\r\n        <th colspan="5" class="switch"ng-bind="years[0].getFullYear()+\' - \'+years[years.length-1].getFullYear()"></th>\r\n        <th ng-click="next(10)">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-class="{\'active\':isSameYear(year),\'now\':isNow(year)}"\r\n                ng-repeat="year in years"\r\n                ng-click="setDate(year)" ng-bind="year.getFullYear()"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="month">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'year\')" ng-bind="date|date:\'yyyy\'"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="month in months"\r\n                ng-class="{\'active\':isSameMonth(month),\'after\':isAfter(month),\'before\':isBefore(month),\'now\':isNow(month)}"\r\n                ng-click="setDate(month)"\r\n                ng-bind="month|date:\'MMM\'"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="hours">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev(24)">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'date\')" ng-bind="date|date:\'dd MMMM yyyy\'"></th>\r\n        <th ng-click="next(24)">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="hour in hours"\r\n                ng-class="{\'now\':isNow(hour),\'active\':isSameHour(hour)}"\r\n                ng-click="setDate(hour)" ng-bind="hour|time"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="minutes">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'hours\')" ng-bind="date|date:\'dd MMMM yyyy\'"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="minute in minutes"\r\n                ng-class="{active:isSameMinutes(minute),\'now\':isNow(minute)}"\r\n                ng-click="setDate(minute)"\r\n                ng-bind="minute|time"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n</div>\r\n'),e.put("templates/daterange.html",'<div>\r\n    <table>\r\n        <tr>\r\n            <td valign="top">\r\n                <div date-picker="start" ng-disabled="disableDatePickers"  class="date-picker" date after="start" before="end" min-view="date" max-view="date"></div>\r\n            </td>\r\n            <td valign="top">\r\n                <div date-picker="end" ng-disabled="disableDatePickers"  class="date-picker" date after="start" before="end"  min-view="date" max-view="date"></div>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n</div>\r\n')}])}(angular);